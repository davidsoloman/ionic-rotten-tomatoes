angular.module("movies",[]).provider("urls",function(){var e;this.setApiKey=function(a){e=a},this.$get=function(){if(!e)throw"missing api key";return{movies:{path:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",params:[{name:"query",apiParam:"q",mandatory:!0},{name:"callback",apiParam:"callback",value:"JSON_CALLBACK"},{name:"apiKey",apiParam:"apikey",value:e}]},movie:{path:"http://api.rottentomatoes.com/api/public/v1.0/movies/:movie.json",params:[{name:"callback",apiParam:"callback",value:"JSON_CALLBACK"},{name:"apiKey",apiParam:"apikey",value:e}]},reviews:{path:"http://api.rottentomatoes.com/api/public/v1.0/movies/:movie/reviews.json",params:[{name:"callback",apiParam:"callback",value:"JSON_CALLBACK"},{name:"apiKey",apiParam:"apikey",value:e}]}}}}),angular.module("movies").factory("moviesService",["$http","urls","$q",function(e,a,o){function i(e,a){var o=[];return e.forEach(function(e){e.mandatory&&!a[e.name]&&o.push(e.name)}),o}function t(e,a){e.forEach(function(e){e.value&&(a[e.apiParam]=e.value)})}function r(e,a,o){Object.keys(o).forEach(function(i){var t=e.filter(function(e){return e.name===i})[0];t&&(a[t.apiParam]=o[i])})}function n(e,o){var n={},c=a[e].params,s=i(c,o);if(s.length)throw{message:"missing mandatory params",items:s};return t(c,n),r(c,n,o),n}return{fetch:function(i){var t=o.defer();try{var r=n("movies",{query:i});e.jsonp(a.movies.path,{params:r}).then(function(e){t.resolve(e.data.movies)},t.reject)}catch(c){console.error(c),t.reject("Can't fetch movies at this time")}return t.promise},fetchMovie:function(o){var i=n("movie",{});return e.jsonp(a.movie.path.replace(":movie",o),{params:i})},fetchReviews:function(i){var t=o.defer(),r=n("reviews",{});return e.jsonp(a.reviews.path.replace(":movie",i),{params:r}).then(t.resolve,t.reject),t}}}]),angular.module("movies").controller("moviesCtrl",["$q","$scope","$location","$ionicLoading","moviesService","$stateParams",function(e,a,o,i,t,r){var n,c=this;c.filter={value:r.q},a.$watch(angular.bind(this,function(){return this.filter.value}),function(e){o.search("q",e)}),this.search=function(a){n&&n.reject("cancel"),n=e.defer(),i.show({template:'<i class="ion-loading-a"></i>',showBackdrop:!1}),c.searching=!0;var o=t.fetch(a).then(function(e){n.resolve(e)});return o.finally(function(){c.searching=!1,i.hide()}),o.catch(function(){c.error=!0}),n.promise}}]),angular.module("movies").controller("movieCtrl",["movie","reviews",function(e,a){var o=this;o.details=e.data,a.promise.then(function(e){o.reviews=e.data.reviews})}]),angular.module("movies").directive("ionSearch",function(){return{restrict:"E",replace:!0,scope:{getData:"&source",model:"=?",search:"=?filter"},link:function(e,a,o){o.minLength=o.minLength||0,e.placeholder=o.placeholder||"",e.search=e.search||{value:""},o.source&&e.$watch("search.value",function(a){a.length>o.minLength?e.getData({str:a}).then(function(a){e.model=a},function(){e.model=[]}):e.model=[]}),e.clearSearch=function(){e.search.value=""}},template:'<div class="item-input-wrapper"><i class="icon ion-android-search"></i><input type="search" debounce="600" placeholder="{{placeholder}}" ng-model="search.value"><i ng-if="search.value.length > 0" ng-click="clearSearch()" class="icon ion-close"></i></div>'}}),angular.module("movies").config(["$stateProvider",function(e){e.state("movies",{url:"/movies?q",reloadOnSearch:!1,templateUrl:"modules/movies/templates/list.html",controller:"moviesCtrl as movies"}),e.state("movie",{url:"/movies/:movie",templateUrl:"modules/movies/templates/item.html",controller:"movieCtrl as movie",resolve:{movie:["moviesService","$stateParams",function(e,a){return e.fetchMovie(a.movie)}],reviews:["moviesService","$stateParams",function(e,a){return e.fetchReviews(a.movie)}]}})}]),angular.module("tomatoes",["ionic","debounce","movies"]).config(["urlsProvider",function(e){e.setApiKey("7ue5rxaj9xn4mhbmsuexug54")}]).run(["$ionicPlatform","$rootScope","$ionicLoading","$window",function(e,a,o,i){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),a.goBack=function(){i.history.back()},a.$on("$stateChangeStart",function(){o.show({template:'<i class="ion-loading-a"></i>',showBackdrop:!1})}),a.$on("$stateChangeSuccess",function(e,i){a.stateName=i.name,o.hide()}),a.$on("$stateChangeError",function(){o.hide()})}]),angular.module("tomatoes").config(["$urlRouterProvider",function(e){e.otherwise(function(e){var a=e.get("$state");a.go("movies")})}]);